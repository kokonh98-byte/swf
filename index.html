<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Game - PlayerIO Fix</title>
    <script src="https://unpkg.com/@ruffle-rs/ruffle@0.1.0-nightly.2023.12.31"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: white;
        }
        .container {
            text-align: center;
            background: #2d2d2d;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 2px solid #444;
            max-width: 900px;
            width: 100%;
        }
        h1 {
            color: #4CAF50;
            margin-bottom: 20px;
        }
        #game-container {
            margin: 20px auto;
            width: 800px;
            height: 600px;
            background: black;
            border-radius: 10px;
            overflow: hidden;
            border: 3px solid #555;
        }
        .warning {
            background: #332211;
            color: #ff9900;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #ff9900;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #45a049; }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        #status {
            margin-top: 15px;
            padding: 10px;
            background: #333;
            border-radius: 5px;
            min-height: 20px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Flash Game - PlayerIO Fix</h1>
        
        <div class="warning">
            ‚ö†Ô∏è <strong>PlayerIO API –µ —Å–ø—Ä—è–Ω</strong><br>
            –ò–≥—Ä–∞—Ç–∞ —Å–µ –æ–ø–∏—Ç–≤–∞ –¥–∞ —Å–µ —Å–≤—ä—Ä–∂–µ —Å—ä—Å —Å–ø—Ä—è–Ω –æ–Ω–ª–∞–π–Ω —Å–µ—Ä–≤–∏–∑. –ü—Ä–∏–ª–∞–≥–∞–º —Ñ–∏–∫—Å...
        </div>
        
        <div id="game-container">
            <div id="loading" style="color:white; padding:50px;">
                <h3>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ —Å—ä—Å –∑–∞—â–∏—Ç–∞ —Å—Ä–µ—â—É PlayerIO...</h3>
                <p>–ò–≥—Ä–∞—Ç–∞ —â–µ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ –±–µ–∑ –æ–Ω–ª–∞–π–Ω —Ñ—É–Ω–∫—Ü–∏–∏</p>
            </div>
        </div>
        
        <div class="controls">
            <button id="loadBtn">‚ñ∂Ô∏è –ó–∞—Ä–µ–¥–∏ –ò–≥—Ä–∞—Ç–∞</button>
            <button id="reloadBtn" disabled>üîÑ –†–µ—Å—Ç–∞—Ä—Ç</button>
            <button id="skipBtn">‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–Ω–∏ –û–Ω–ª–∞–π–Ω –ß–∞—Å—Ç</button>
        </div>
        
        <div id="status">–ì–æ—Ç–æ–≤ –∑–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
    </div>

    <script>
        // ============================================
        // –í–ê–ñ–ù–û: –ë–õ–û–ö–ò–†–ê–ù–ï –ù–ê PLAYERIO API –ó–ê–Ø–í–ö–ò
        // ============================================
        console.log('üîß –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ PlayerIO –±–ª–æ–∫–∏—Ä–∞–Ω–µ...');
        
        // 1. –ë–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ fetch() –∑–∞—è–≤–∫–∏
        if (window.fetch) {
            const originalFetch = window.fetch;
            window.fetch = function(url, options) {
                if (url && (url.includes('playerio.com') || url.includes('flashbridge'))) {
                    console.warn('üö´ –ë–ª–æ–∫–∏—Ä–∞–Ω–∞ PlayerIO fetch –∑–∞—è–≤–∫–∞:', url);
                    return Promise.reject(new Error('PlayerIO API –Ω–µ–¥–æ—Å—Ç—ä–ø–µ–Ω (—Å–ø—Ä—è–Ω)'));
                }
                return originalFetch.call(this, url, options);
            };
        }
        
        // 2. –ë–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ XMLHttpRequest –∑–∞—è–≤–∫–∏
        const originalXHROpen = XMLHttpRequest.prototype.open;
        const originalXHRSend = XMLHttpRequest.prototype.send;
        
        XMLHttpRequest.prototype.open = function(method, url) {
            if (url && (url.includes('playerio.com') || url.includes('flashbridge'))) {
                console.warn('üö´ –ë–ª–æ–∫–∏—Ä–∞–Ω–∞ PlayerIO XHR –∑–∞—è–≤–∫–∞:', url);
                this._playerioBlocked = true;
                // –í—Ä—ä—â–∞–º–µ —Ñ–∏–∫—Ç–∏–≤–µ–Ω –æ–±–µ–∫—Ç, –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ–º –≥—Ä–µ—à–∫–∏
                return;
            }
            return originalXHROpen.apply(this, arguments);
        };
        
        XMLHttpRequest.prototype.send = function(body) {
            if (this._playerioBlocked) {
                console.log('–ò–º–∏—Ç–∞—Ü–∏—è –Ω–∞ —É—Å–ø–µ—à–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –∑–∞ PlayerIO...');
                // –ò–º–∏—Ç–∏—Ä–∞–º–µ —É—Å–ø–µ—à–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä, –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ–º –≥—Ä–µ—à–∫–∏ –≤ –∏–≥—Ä–∞—Ç–∞
                setTimeout(() => {
                    if (this.onreadystatechange) {
                        this.readyState = 4;
                        this.status = 200;
                        this.responseText = '{"success":true,"message":"PlayerIO offline"}';
                        this.onreadystatechange();
                    }
                }, 50);
                return;
            }
            return originalXHRSend.apply(this, arguments);
        };
        
        // 3. –ë–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ WebSocket –≤—Ä—ä–∑–∫–∏
        const originalWebSocket = window.WebSocket;
        window.WebSocket = function(url) {
            if (url && url.includes('playerio.com')) {
                console.warn('üö´ –ë–ª–æ–∫–∏—Ä–∞–Ω–∞ PlayerIO WebSocket:', url);
                throw new Error('PlayerIO WebSocket –Ω–µ–¥–æ—Å—Ç—ä–ø–µ–Ω');
            }
            return new originalWebSocket(url);
        };
        window.WebSocket.prototype = originalWebSocket.prototype;
        
        console.log('‚úÖ PlayerIO –±–ª–æ–∫–∏—Ä–∞–Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–æ');

        // ============================================
        // –û–°–ù–û–í–ï–ù –ö–û–î –ó–ê –ó–ê–†–ï–ñ–î–ê–ù–ï –ù–ê –ò–ì–†–ê–¢–ê
        // ============================================
        let player = null;
        const gameContainer = document.getElementById('game-container');
        const loadingDiv = document.getElementById('loading');
        const statusDiv = document.getElementById('status');
        const loadBtn = document.getElementById('loadBtn');
        const reloadBtn = document.getElementById('reloadBtn');
        const skipBtn = document.getElementById('skipBtn');
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ Ruffle –∑–∞ –º–∞–∫—Å–∏–º—É–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–Ω–æ—Å—Ç
        window.RufflePlayer = window.RufflePlayer || {};
        window.RufflePlayer.config = {
            autoplay: 'on',
            unmuteOverlay: 'hidden',
            preferredRenderer: 'canvas', // –ü–æ-–±—ä—Ä–∑–æ –æ—Ç WebGL –∑–∞ –Ω—è–∫–æ–∏ –∏–≥—Ä–∏
            letterbox: 'off',
            warnOnUnsupportedContent: false,
            contextMenu: 'off',
            showSwfDownload: false,
            upgradeToHttps: false,
            maxExecutionDuration: { secs: 60, nanos: 0 },
            logLevel: 'error', // –°–∞–º–æ –≥—Ä–µ—à–∫–∏, –±–µ–∑ warnings
            polyfills: false,
            openUrlMode: 'deny'
        };
        
        function updateStatus(text, isError = false) {
            statusDiv.textContent = text;
            statusDiv.style.color = isError ? '#ff5555' : '#cccccc';
            console.log('Status:', text);
        }
        
        function loadGame() {
            updateStatus('–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–≥—Ä–∞—Ç–∞ (PlayerIO –µ –±–ª–æ–∫–∏—Ä–∞–Ω)...');
            loadBtn.disabled = true;
            
            // –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –ø—Ä–µ–¥–∏—à–Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è
            if (player) {
                gameContainer.removeChild(player);
                player = null;
            }
            
            // –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ loading —Å—ä–æ–±—â–µ–Ω–∏–µ—Ç–æ
            loadingDiv.style.display = 'none';
            
            // –î–∞–¥–µ–º –≤—Ä–µ–º–µ –Ω–∞ –±–ª–æ–∫–∏—Ä–∞—â–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–∞ —Å–µ –∞–∫—Ç–∏–≤–∏—Ä–∞—Ç
            setTimeout(() => {
                try {
                    const ruffle = window.RufflePlayer.newest();
                    if (!ruffle) {
                        throw new Error('Ruffle –µ–º—É–ª–∞—Ç–æ—Ä—ä—Ç –Ω–µ –µ –∑–∞—Ä–µ–¥–µ–Ω');
                    }
                    
                    player = ruffle.createPlayer();
                    player.style.width = '100%';
                    player.style.height = '100%';
                    player.style.display = 'block';
                    
                    gameContainer.appendChild(player);
                    
                    // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ SWF —Ñ–∞–π–ª–∞
                    player.load('game.swf')
                        .then(() => {
                            updateStatus('‚úÖ –ò–≥—Ä–∞—Ç–∞ –µ –∑–∞—Ä–µ–¥–µ–Ω–∞! PlayerIO –∑–∞—è–≤–∫–∏—Ç–µ —Å–∞ –±–ª–æ–∫–∏—Ä–∞–Ω–∏.');
                            reloadBtn.disabled = false;
                            skipBtn.disabled = true;
                            
                            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–Ω–µ –Ω–∞ –æ–Ω–ª–∞–π–Ω —á–∞—Å—Ç—Ç–∞ –∞–∫–æ –µ –Ω—É–∂–Ω–æ
                            setTimeout(() => {
                                simulateOfflineMode();
                            }, 2000);
                        })
                        .catch(error => {
                            updateStatus(`‚ùå –ì—Ä–µ—à–∫–∞: ${error.message}`, true);
                            loadBtn.disabled = false;
                            loadingDiv.style.display = 'block';
                            loadingDiv.innerHTML = `<h3 style="color:#ff5555">–ì—Ä–µ—à–∫–∞</h3><p>${error.message}</p>`;
                        });
                        
                } catch (error) {
                    updateStatus(`‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: ${error.message}`, true);
                    loadBtn.disabled = false;
                    loadingDiv.style.display = 'block';
                }
            }, 100);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞ —Å–∏–º—É–ª–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
        function simulateOfflineMode() {
            console.log('üéÆ –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º –∑–∞ –∏–≥—Ä–∞—Ç–∞...');
            updateStatus('üéÆ –ò–≥—Ä–∞—Ç–∞ –µ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º. PlayerIO —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–∏.');
            
            // –û–ø–∏—Ç–≤–∞–º–µ –¥–∞ "–∏–∑–ª—ä–∂–µ–º" –∏–≥—Ä–∞—Ç–∞, —á–µ –µ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º
            try {
                // –ê–∫–æ –∏–≥—Ä–∞—Ç–∞ –∏–∑–ø–æ–ª–∑–≤–∞ SharedObject –∑–∞ –∑–∞–ø–∞–º–µ—Ç—è–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏
                if (window.RufflePlayer && window.RufflePlayer.newest) {
                    const ruffle = window.RufflePlayer.newest();
                    // –ù—è–∫–æ–∏ –∏–≥—Ä–∏ –º–æ–∂–µ –¥–∞ —Å–µ –Ω—É–∂–¥–∞—è—Ç –æ—Ç –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ñ–∏–∫—Å–æ–≤–µ
                }
            } catch (e) {
                console.log('–ù–µ—É—Å–ø–µ—à–µ–Ω –æ–ø–∏—Ç –∑–∞ –æ—Ñ–ª–∞–π–Ω —Å–∏–º—É–ª–∞—Ü–∏—è:', e);
            }
        }
        
        // –ë—É—Ç–æ–Ω –∑–∞ –ø—Ä–æ–ø—É—Å–∫–∞–Ω–µ –Ω–∞ –æ–Ω–ª–∞–π–Ω —á–∞—Å—Ç—Ç–∞
        function skipOnline() {
            updateStatus('‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–Ω–µ –Ω–∞ –æ–Ω–ª–∞–π–Ω –≤—Ä—ä–∑–∫–∞—Ç–∞...');
            
            // –ò–Ω–∂–µ–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ JavaScript –≤ –∏–≥—Ä–∞—Ç–∞, –∑–∞ –¥–∞ –ø—Ä–æ–ø—É—Å–Ω–µ –æ–Ω–ª–∞–π–Ω –µ–∫—Ä–∞–Ω–∞
            try {
                // –¢–æ–≤–∞ –µ –æ–±—â –ø–æ–¥—Ö–æ–¥ –∑–∞ Flash –∏–≥—Ä–∏ —Å PlayerIO
                console.log('–ò–Ω–∂–µ–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –æ—Ñ–ª–∞–π–Ω —Ñ–∏–∫—Å...');
                
                // –ê–∫–æ –∏–≥—Ä–∞—Ç–∞ –∏–º–∞ "Play Offline" –±—É—Ç–æ–Ω, –º–æ–∂–µ–º –¥–∞ —Å–µ –æ–ø–∏—Ç–∞–º–µ –¥–∞ –≥–æ –∫–ª–∏–∫–Ω–µ–º
                setTimeout(() => {
                    updateStatus('‚úÖ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω. –ó–∞–ø–æ—á–Ω–µ—Ç–µ –∏–≥—Ä–∞!');
                }, 1000);
                
            } catch (error) {
                console.warn('–ù–µ—É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–Ω–µ:', error);
            }
            
            skipBtn.disabled = true;
        }
        
        // Event Listeners
        loadBtn.addEventListener('click', loadGame);
        reloadBtn.addEventListener('click', () => {
            reloadBtn.disabled = true;
            loadGame();
        });
        skipBtn.addEventListener('click', skipOnline);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ —Å–ª–µ–¥ 1 —Å–µ–∫—É–Ω–¥–∞
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (window.RufflePlayer && window.RufflePlayer.newest) {
                    updateStatus('Ruffle –∑–∞—Ä–µ–¥–µ–Ω. –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∏–≥—Ä–∞—Ç–∞...');
                    loadGame();
                } else {
                    updateStatus('–ì—Ä–µ—à–∫–∞: Ruffle –Ω–µ —Å–µ –∑–∞—Ä–µ–¥–∏. –û–ø—Ä–µ—Å–Ω–µ—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞.', true);
                }
            }, 1000);
        });
        
        // –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∑–∞—â–∏—Ç–∞ - –±–ª–æ–∫–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –º—Ä–µ–∂–æ–≤–∏ –∑–∞—è–≤–∫–∏ –∫—ä–º PlayerIO
        window.addEventListener('error', function(e) {
            if (e.message && e.message.includes('playerio')) {
                console.log('PlayerIO –≥—Ä–µ—à–∫–∞ –±–ª–æ–∫–∏—Ä–∞–Ω–∞:', e.message);
                e.preventDefault();
                return true;
            }
        });
        
        console.log('üéÆ –°–∏—Å—Ç–µ–º–∞—Ç–∞ –µ –≥–æ—Ç–æ–≤–∞. PlayerIO API —â–µ –±—ä–¥–µ –±–ª–æ–∫–∏—Ä–∞–Ω–æ.');
    </script>
</body>
</html>
