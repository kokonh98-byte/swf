<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Game</title>
    <style>
        /* CRITICAL - —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ —Ç–æ—á–Ω–∏ —Ç–µ–∑–∏ —Å—Ç–∏–ª–æ–≤–µ */
        html, body {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }
        
        ruffle-player, ruffle-object {
            width: 596px !important;  /* –¢–û–ß–ù–û –∫–∞—Ç–æ –≤ SWF: 596x428 */
            height: 428px !important;
            display: block !important;
            background: #000 !important;
            border: 2px solid red !important; /* –ó–∞ –¥–µ–±—ä–≥ - —â–µ –≤–∏–¥–∏–º —Ä–∞–º–∫–∞—Ç–∞ */
        }
    </style>
    
    <script>
        // –ú–ù–û–ì–û –í–ê–ñ–ù–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        window.RufflePlayer = window.RufflePlayer || {};
        window.RufflePlayer.config = {
            publicPath: "",
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞ —Ä–µ–Ω–¥–∏—Ä–∞–Ω–µ
            autoplay: "on",
            unmuteOverlay: "hidden",
            backgroundColor: "#000000",
            letterbox: "off",  // –ü–†–û–ú–ï–ù–ï–¢–ï –Ω–∞ "off" –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –∏–≥—Ä–∞—Ç–∞
            scale: "showAll",
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞ Flash Player
            wmode: "direct",  // –ü—Ä–æ–±–≤–∞–π—Ç–µ "direct", "gpu", "window"
            quality: "high",
            allowScriptAccess: "always",
            allowNetworking: "all",
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç
            playerVersion: 32,
            maxExecutionDuration: { secs: 15, nanos: 0 },
            upgradeToHttps: false,
            polyfills: true,
            
            // –î–µ–±—ä–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            logLevel: "warn",
            showSwfDownload: false,
            contextMenu: false,
            
            // –§–ò–ö–° –∑–∞ ActionScript 3
            base: "./",
            menu: false,
            salign: "",
            align: "center"
        };
    </script>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞ –∏–≥—Ä–∞—Ç–∞ -->
    <div id="game-wrapper">
        <div id="game-container"></div>
    </div>
    
    <!-- –î–µ–±—ä–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div id="debug" style="position:fixed; top:10px; left:10px; color:white; background:rgba(0,0,0,0.7); padding:10px; font-family:monospace; font-size:12px; z-index:9999;">
        –°—Ç–∞—Ç—É—Å: –ó–∞—Ä–µ–∂–¥–∞–Ω–µ...
    </div>
    
    <script src="ruffle.js"></script>
    
    <script>
        // –î–ï–ë–™–ì –§–£–ù–ö–¶–ò–ò
        function updateDebug(msg) {
            const debugDiv = document.getElementById('debug');
            if (debugDiv) {
                debugDiv.innerHTML = `üïπÔ∏è ${msg}`;
                console.log(msg);
            }
        }
        
        // –§–ò–ö–° –∑–∞ —á–µ—Ä–µ–Ω –µ–∫—Ä–∞–Ω
        function forceRedraw() {
            const player = document.querySelector('ruffle-player, ruffle-object');
            if (player) {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ —Ä–µ-—Ä–µ–Ω–¥–∏—Ä–∞–Ω–µ
                player.style.display = 'none';
                setTimeout(() => {
                    player.style.display = 'block';
                    updateDebug('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ —Ä–µ-—Ä–µ–Ω–¥–∏—Ä–∞–Ω–µ');
                }, 50);
            }
        }
        
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        async function initGame() {
            try {
                updateDebug('1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Ruffle...');
                
                // –ò–∑—á–∞–∫–≤–∞–Ω–µ –Ω–∞ Ruffle
                if (!window.RufflePlayer || !window.RufflePlayer.newest) {
                    setTimeout(initGame, 100);
                    return;
                }
                
                updateDebug('2. Ruffle –µ –≥–æ—Ç–æ–≤, —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—è...');
                
                const ruffle = window.RufflePlayer.newest();
                const container = document.getElementById('game-container');
                
                // –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ
                container.innerHTML = '';
                
                // –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø–ª–µ—ä—Ä
                const player = ruffle.createPlayer();
                
                // –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–ò –∞—Ç—Ä–∏–±—É—Ç–∏
                player.setAttribute('width', '596');
                player.setAttribute('height', '428');
                player.style.width = '596px';
                player.style.height = '428px';
                player.style.minWidth = '596px';
                player.style.minHeight = '428px';
                player.style.maxWidth = '596px';
                player.style.maxHeight = '428px';
                player.style.backgroundColor = '#000000';
                player.style.overflow = 'visible';
                
                // –î–æ–±–∞–≤—è–Ω–µ –∫—ä–º DOM
                container.appendChild(player);
                
                updateDebug('3. –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ SWF —Ñ–∞–π–ª–∞...');
                
                // –ó–ê–†–ï–ñ–î–ê–ù–ï —Å—ä—Å —Å–ø–µ—Ü–∏–∞–ª–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
                const loadPromise = player.load({
                    url: 'game.swf',
                    width: 596,
                    height: 428,
                    background: '#000000',
                    allowScriptAccess: 'always',
                    base: './',
                    scale: 'showAll',
                    salign: '',
                    wmode: 'direct'
                });
                
                // –¢–∞–π–º–∞—É—Ç –∑–∞ —Å–∏–≥—É—Ä–Ω–æ—Å—Ç
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ (10s)')), 10000);
                });
                
                // –ò–∑—á–∞–∫–≤–∞–Ω–µ –Ω–∞ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ
                await Promise.race([loadPromise, timeoutPromise]);
                
                updateDebug('4. ‚úÖ –ò–≥—Ä–∞—Ç–∞ –µ –∑–∞—Ä–µ–¥–µ–Ω–∞! –†–∞–∑–º–µ—Ä: 596x428');
                
                // –í–∞–∂–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è —Å–ª–µ–¥ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
                setTimeout(() => {
                    // –§–æ–∫—É—Å
                    player.focus();
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª–Ω–æ —Ä–µ-—Ä–µ–Ω–¥–∏—Ä–∞–Ω–µ
                    forceRedraw();
                    
                    // –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∞—É–¥–∏–æ
                    if (window.RufflePlayer.audioContext && window.RufflePlayer.audioContext.state === 'suspended') {
                        window.RufflePlayer.audioContext.resume();
                        updateDebug('–ê—É–¥–∏–æ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–æ');
                    }
                    
                    // –î–µ–±—ä–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∏–≥—Ä–∞—Ç–∞
                    console.log('üéÆ –ò–≥—Ä–∞—Ç–∞ –µ –∑–∞—Ä–µ–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                    console.log('üìê –û—á–∞–∫–≤–∞–Ω —Ä–∞–∑–º–µ—Ä: 596x428');
                    console.log('üé® Background: #000000');
                    
                }, 500);
                
                // –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ñ–∏–∫—Å–æ–≤–µ —Å–ª–µ–¥ 2 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    updateDebug('5. –ü—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–∞—â–∏ —Ñ–∏–∫—Å–æ–≤–µ...');
                    
                    // –û—â–µ —Ä–µ-—Ä–µ–Ω–¥–∏—Ä–∞–Ω–µ
                    forceRedraw();
                    
                    // –ü—Ä–æ–º—è–Ω–∞ –Ω–∞ scale –∞–∫–æ –≤—Å–µ –æ—â–µ –Ω–µ —Å–µ –≤–∏–∂–¥–∞
                    const ruffleEl = document.querySelector('ruffle-player, ruffle-object');
                    if (ruffleEl) {
                        ruffleEl.style.transform = 'scale(1)';
                        ruffleEl.style.imageRendering = 'crisp-edges';
                    }
                    
                    // –°–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ –¥–µ–±—ä–≥ –ø–∞–Ω–µ–ª–∞
                    setTimeout(() => {
                        document.getElementById('debug').style.opacity = '0.3';
                    }, 3000);
                    
                }, 2000);
                
            } catch (error) {
                updateDebug(`‚ùå –ì–†–ï–®–ö–ê: ${error.message}`);
                console.error('–§–∞—Ç–∞–ª–Ω–∞ –≥—Ä–µ—à–∫–∞:', error);
                
                // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –≥—Ä–µ—à–∫–∞ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
                document.getElementById('game-wrapper').innerHTML = `
                    <div style="color: white; text-align: center; padding: 30px; font-family: Arial;">
                        <h2 style="color: #ff5555;">–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ</h2>
                        <p style="margin: 20px 0; background: #222; padding: 15px; border-radius: 8px;">
                            ${error.message}
                        </p>
                        <div style="margin: 20px;">
                            <button onclick="location.reload()" style="padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                üîÑ –û–ø—Ä–µ—Å–Ω–∏
                            </button>
                            <button onclick="initGame()" style="padding: 10px 20px; margin: 5px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                üîß –û–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ
                            </button>
                        </div>
                        <p style="color: #aaa; font-size: 12px; margin-top: 20px;">
                            SWF –≤–µ—Ä—Å–∏—è: 41 | –†–∞–∑–º–µ—Ä: 596x428 | FPS: 30
                        </p>
                    </div>
                `;
            }
        }
        
        // –ê–õ–¢–ï–†–ù–ê–¢–ò–í–ï–ù –ö–û–î –ê–ö–û –ì–û–†–ù–ò–Ø–¢ –ù–ï –†–ê–ë–û–¢–ò
        function tryAlternativeLoad() {
            updateDebug('üîß –û–ø–∏—Ç–≤–∞–º –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–µ–Ω –º–µ—Ç–æ–¥...');
            
            const container = document.getElementById('game-container');
            container.innerHTML = '';
            
            // –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ iframe –∫–∞—Ç–æ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
            const iframe = document.createElement('iframe');
            iframe.src = 'game.swf';
            iframe.style.width = '596px';
            iframe.style.height = '428px';
            iframe.style.border = 'none';
            iframe.style.background = '#000';
            iframe.style.display = 'block';
            iframe.style.margin = 'auto';
            
            container.appendChild(iframe);
            updateDebug('üîÑ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –ø—Ä–µ–∑ iframe...');
        }
        
        // –°–¢–ê–†–¢–ò–†–ê–ù–ï
        document.addEventListener('DOMContentLoaded', function() {
            updateDebug('üöÄ –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ Flash Player...');
            
            // –ó–∞–ø–æ—á–≤–∞–º–µ —Å –æ—Å–Ω–æ–≤–Ω–∏—è –º–µ—Ç–æ–¥
            initGame();
            
            // –ê–∫–æ —Å–ª–µ–¥ 5 —Å–µ–∫—É–Ω–¥–∏ –≤—Å–µ –æ—â–µ –∏–º–∞ –ø—Ä–æ–±–ª–µ–º, –ø—Ä–æ–±–≤–∞–º–µ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
            setTimeout(() => {
                const player = document.querySelector('ruffle-player, ruffle-object');
                if (!player || player.offsetWidth === 0) {
                    updateDebug('‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–∏—è—Ç –º–µ—Ç–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∏, –æ–ø–∏—Ç–≤–∞–º –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞...');
                    tryAlternativeLoad();
                }
            }, 5000);
            
            // –ö–ª–∏–∫ –∑–∞ —Ä–µ-–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ
            document.addEventListener('click', function() {
                forceRedraw();
                if (window.RufflePlayer && window.RufflePlayer.audioContext) {
                    window.RufflePlayer.audioContext.resume();
                }
            });
        });
        
        // –î–µ–±—ä–≥ –Ω–∞ —Ä–∞–∑–º–µ—Ä–∏—Ç–µ
        setInterval(() => {
            const player = document.querySelector('ruffle-player, ruffle-object');
            if (player) {
                console.log('–†–∞–∑–º–µ—Ä–∏ –Ω–∞ –ø–ª–µ—ä—Ä–∞:', {
                    offsetWidth: player.offsetWidth,
                    offsetHeight: player.offsetHeight,
                    clientWidth: player.clientWidth,
                    clientHeight: player.clientHeight,
                    style: player.style.cssText
                });
            }
        }, 2000);
        
    </script>
</body>
</html>
